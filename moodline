#!/usr/bin/env python3
# Copyright (c) 2025 Daiki Yamashita
# License: MIT

import sys


POSITIVE_WORDS = [
    "楽しい", "うれしい", "嬉しい", "最高", "よかった", "良かった",
    "great", "good", "awesome", "happy",
]


NEGATIVE_WORDS = [
    "最悪", "疲れた", "つらい", "辛い", "嫌だ", "むかつく",
    "bad", "terrible", "awful", "sad",
]


ANGRY_WORDS = [
    "怒る", "怒って", "腹立つ", "イライラ", "ふざけるな",
    "angry", "mad",
]


def classify_mood(text: str) -> str:
    """Return mood label for given text."""
    lower = text.lower()

    pos_score = sum(word in lower for word in POSITIVE_WORDS)
    neg_score = sum(word in lower for word in NEGATIVE_WORDS)
    ang_score = sum(word in lower for word in ANGRY_WORDS)

    if pos_score == 0 and neg_score == 0 and ang_score == 0:
        return "[neutral]"

    scores = {
        "[positive]": pos_score,
        "[negative]": neg_score,
        "[angry]": ang_score,
    }

    label = max(scores, key=scores.get)
    if scores[label] == 0:
        return "[neutral]"
    return label


def shorten(text: str, limit: int = 80) -> str:
    """Shorten text if too long."""
    text = text.rstrip("\n")
    if len(text) <= limit:
        return text
    return text[: limit - 1] + "…"


def main() -> None:
    """Main entry point."""
    if sys.stdin.isatty():
        print("Usage: echo 'text' | moodline", file=sys.stderr)
        sys.exit(1)

    for line in sys.stdin:
        if not line.strip():
            continue
        mood = classify_mood(line)
        summary = shorten(line)
        print(f"{mood} {summary}")


if __name__ == "__main__":
    main()

